// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: purchase_orders.sql

package repository

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const getPurchaseOrderWithReceivedQty = `-- name: GetPurchaseOrderWithReceivedQty :many
SELECT 
    po.id,
    po.po_number,
    po.status,
    po.total_amount,
    po.expected_delivery_date,
    sup.name AS supplier_name,
    pol.line_number,
    pol.product_id,
    pol.quantity           AS ordered_qty,
    pol.received_quantity  AS received_qty,
    pol.quantity - pol.received_quantity AS pending_qty,
    p.sku,
    p.name AS product_name
FROM purchase_orders po
JOIN suppliers sup ON po.supplier_id = sup.id
JOIN purchase_order_lines pol ON pol.purchase_order_id = po.id
JOIN products p ON pol.product_id = p.id
WHERE po.id = $1
ORDER BY pol.line_number
`

type GetPurchaseOrderWithReceivedQtyRow struct {
	ID                   int32          `json:"id"`
	PoNumber             string         `json:"po_number"`
	Status               pgtype.Text    `json:"status"`
	TotalAmount          pgtype.Numeric `json:"total_amount"`
	ExpectedDeliveryDate pgtype.Date    `json:"expected_delivery_date"`
	SupplierName         string         `json:"supplier_name"`
	LineNumber           pgtype.Int4    `json:"line_number"`
	ProductID            int32          `json:"product_id"`
	OrderedQty           pgtype.Numeric `json:"ordered_qty"`
	ReceivedQty          pgtype.Numeric `json:"received_qty"`
	PendingQty           int32          `json:"pending_qty"`
	Sku                  string         `json:"sku"`
	ProductName          string         `json:"product_name"`
}

func (q *Queries) GetPurchaseOrderWithReceivedQty(ctx context.Context, id int32) ([]GetPurchaseOrderWithReceivedQtyRow, error) {
	rows, err := q.db.Query(ctx, getPurchaseOrderWithReceivedQty, id)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetPurchaseOrderWithReceivedQtyRow
	for rows.Next() {
		var i GetPurchaseOrderWithReceivedQtyRow
		if err := rows.Scan(
			&i.ID,
			&i.PoNumber,
			&i.Status,
			&i.TotalAmount,
			&i.ExpectedDeliveryDate,
			&i.SupplierName,
			&i.LineNumber,
			&i.ProductID,
			&i.OrderedQty,
			&i.ReceivedQty,
			&i.PendingQty,
			&i.Sku,
			&i.ProductName,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

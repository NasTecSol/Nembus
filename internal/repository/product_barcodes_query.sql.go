// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: product_barcodes_query.sql

package repository

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const checkBarcodeExists = `-- name: CheckBarcodeExists :one
SELECT EXISTS(
    SELECT 1 FROM product_barcodes
    WHERE barcode = $1
) AS exists
`

func (q *Queries) CheckBarcodeExists(ctx context.Context, barcode string) (bool, error) {
	row := q.db.QueryRow(ctx, checkBarcodeExists, barcode)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const createProductBarcode = `-- name: CreateProductBarcode :one
INSERT INTO product_barcodes (
    product_id,
    product_variant_id,
    barcode,
    barcode_type,
    is_primary,
    metadata
) VALUES (
    $1, $2, $3, $4, $5, $6
) RETURNING id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at
`

type CreateProductBarcodeParams struct {
	ProductID        int32       `json:"product_id"`
	ProductVariantID pgtype.Int4 `json:"product_variant_id"`
	Barcode          string      `json:"barcode"`
	BarcodeType      pgtype.Text `json:"barcode_type"`
	IsPrimary        pgtype.Bool `json:"is_primary"`
	Metadata         []byte      `json:"metadata"`
}

func (q *Queries) CreateProductBarcode(ctx context.Context, arg CreateProductBarcodeParams) (ProductBarcode, error) {
	row := q.db.QueryRow(ctx, createProductBarcode,
		arg.ProductID,
		arg.ProductVariantID,
		arg.Barcode,
		arg.BarcodeType,
		arg.IsPrimary,
		arg.Metadata,
	)
	var i ProductBarcode
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.ProductVariantID,
		&i.Barcode,
		&i.BarcodeType,
		&i.IsPrimary,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const deleteProductBarcode = `-- name: DeleteProductBarcode :exec
DELETE FROM product_barcodes
WHERE id = $1
`

func (q *Queries) DeleteProductBarcode(ctx context.Context, id int32) error {
	_, err := q.db.Exec(ctx, deleteProductBarcode, id)
	return err
}

const getPrimaryBarcode = `-- name: GetPrimaryBarcode :one
SELECT id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at FROM product_barcodes
WHERE product_id = $1 AND is_primary = true
LIMIT 1
`

func (q *Queries) GetPrimaryBarcode(ctx context.Context, productID int32) (ProductBarcode, error) {
	row := q.db.QueryRow(ctx, getPrimaryBarcode, productID)
	var i ProductBarcode
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.ProductVariantID,
		&i.Barcode,
		&i.BarcodeType,
		&i.IsPrimary,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const getProductBarcode = `-- name: GetProductBarcode :one
SELECT id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at FROM product_barcodes
WHERE id = $1
`

func (q *Queries) GetProductBarcode(ctx context.Context, id int32) (ProductBarcode, error) {
	row := q.db.QueryRow(ctx, getProductBarcode, id)
	var i ProductBarcode
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.ProductVariantID,
		&i.Barcode,
		&i.BarcodeType,
		&i.IsPrimary,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const getProductByBarcode = `-- name: GetProductByBarcode :one
SELECT pb.id, pb.product_id, pb.product_variant_id, pb.barcode, pb.barcode_type, pb.is_primary, pb.metadata, pb.created_at, p.name AS product_name, p.sku
FROM product_barcodes pb
JOIN products p ON pb.product_id = p.id
WHERE pb.barcode = $1
`

type GetProductByBarcodeRow struct {
	ID               int32            `json:"id"`
	ProductID        int32            `json:"product_id"`
	ProductVariantID pgtype.Int4      `json:"product_variant_id"`
	Barcode          string           `json:"barcode"`
	BarcodeType      pgtype.Text      `json:"barcode_type"`
	IsPrimary        pgtype.Bool      `json:"is_primary"`
	Metadata         []byte           `json:"metadata"`
	CreatedAt        pgtype.Timestamp `json:"created_at"`
	ProductName      string           `json:"product_name"`
	Sku              string           `json:"sku"`
}

func (q *Queries) GetProductByBarcode(ctx context.Context, barcode string) (GetProductByBarcodeRow, error) {
	row := q.db.QueryRow(ctx, getProductByBarcode, barcode)
	var i GetProductByBarcodeRow
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.ProductVariantID,
		&i.Barcode,
		&i.BarcodeType,
		&i.IsPrimary,
		&i.Metadata,
		&i.CreatedAt,
		&i.ProductName,
		&i.Sku,
	)
	return i, err
}

const listProductBarcodes = `-- name: ListProductBarcodes :many
SELECT id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at FROM product_barcodes
ORDER BY barcode
`

func (q *Queries) ListProductBarcodes(ctx context.Context) ([]ProductBarcode, error) {
	rows, err := q.db.Query(ctx, listProductBarcodes)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ProductBarcode
	for rows.Next() {
		var i ProductBarcode
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.ProductVariantID,
			&i.Barcode,
			&i.BarcodeType,
			&i.IsPrimary,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listProductBarcodesByProduct = `-- name: ListProductBarcodesByProduct :many
SELECT id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at FROM product_barcodes
WHERE product_id = $1
ORDER BY is_primary DESC, barcode
`

func (q *Queries) ListProductBarcodesByProduct(ctx context.Context, productID int32) ([]ProductBarcode, error) {
	rows, err := q.db.Query(ctx, listProductBarcodesByProduct, productID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ProductBarcode
	for rows.Next() {
		var i ProductBarcode
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.ProductVariantID,
			&i.Barcode,
			&i.BarcodeType,
			&i.IsPrimary,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listProductBarcodesByVariant = `-- name: ListProductBarcodesByVariant :many
SELECT id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at FROM product_barcodes
WHERE product_variant_id = $1
ORDER BY is_primary DESC, barcode
`

func (q *Queries) ListProductBarcodesByVariant(ctx context.Context, productVariantID pgtype.Int4) ([]ProductBarcode, error) {
	rows, err := q.db.Query(ctx, listProductBarcodesByVariant, productVariantID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ProductBarcode
	for rows.Next() {
		var i ProductBarcode
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.ProductVariantID,
			&i.Barcode,
			&i.BarcodeType,
			&i.IsPrimary,
			&i.Metadata,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const setPrimaryBarcode = `-- name: SetPrimaryBarcode :exec
UPDATE product_barcodes
SET is_primary = (id = $2)
WHERE product_id = $1
`

type SetPrimaryBarcodeParams struct {
	ProductID int32 `json:"product_id"`
	ID        int32 `json:"id"`
}

func (q *Queries) SetPrimaryBarcode(ctx context.Context, arg SetPrimaryBarcodeParams) error {
	_, err := q.db.Exec(ctx, setPrimaryBarcode, arg.ProductID, arg.ID)
	return err
}

const updateProductBarcode = `-- name: UpdateProductBarcode :one
UPDATE product_barcodes
SET 
    barcode_type = $2,
    is_primary = $3,
    metadata = $4
WHERE id = $1
RETURNING id, product_id, product_variant_id, barcode, barcode_type, is_primary, metadata, created_at
`

type UpdateProductBarcodeParams struct {
	ID          int32       `json:"id"`
	BarcodeType pgtype.Text `json:"barcode_type"`
	IsPrimary   pgtype.Bool `json:"is_primary"`
	Metadata    []byte      `json:"metadata"`
}

func (q *Queries) UpdateProductBarcode(ctx context.Context, arg UpdateProductBarcodeParams) (ProductBarcode, error) {
	row := q.db.QueryRow(ctx, updateProductBarcode,
		arg.ID,
		arg.BarcodeType,
		arg.IsPrimary,
		arg.Metadata,
	)
	var i ProductBarcode
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.ProductVariantID,
		&i.Barcode,
		&i.BarcodeType,
		&i.IsPrimary,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}
